"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const chalk_1 = require("chalk");
const command_1 = require("@oclif/command");
const config_1 = require("../config");
const io_1 = require("../util/io");
const fileMakerService = require("../service/fileMaker");
class MakePublish extends command_1.Command {
    /**
     * CLI command execution handler.
     *
     * @returns {Promise<void>}
     */
    async run() {
        const { flags: parsedFlags } = this.parse(MakePublish);
        const config = await (0, config_1.loadConfig)(parsedFlags.config);
        await (0, io_1.printLine)();
        const { ignoredList, movedList } = await fileMakerService.publish(config);
        const movedCount = movedList.length;
        // Completed migrations.
        for (const template of movedList) {
            await (0, io_1.printLine)((0, chalk_1.cyan)(`   â€¢ ${template}`));
        }
        for (const template of ignoredList) {
            await (0, io_1.printLine)((0, chalk_1.grey)(`   - ${template} (exists)`));
        }
        if (movedCount) {
            await (0, io_1.printInfo)('\n Templates published successfully.\n');
        }
        else {
            await (0, io_1.printLine)('\n Nothing to publish.\n');
        }
    }
}
MakePublish.description = 'Publish migration templates files.';
MakePublish.flags = {
    config: command_1.flags.string({
        char: 'c',
        description: 'Custom configuration file.'
    })
};
exports.default = MakePublish;
